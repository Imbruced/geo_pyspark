

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Welcome to geo_pyspark documentation! &mdash; geo_pyspark 0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
<link rel="stylesheet" type="text/css" href="_static/handsontable.full.min.css">
<script src="_static/handsontable.full.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> geo_pyspark
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Welcome to geo_pyspark documentation!</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#installing-from-wheel-file">Installing from wheel file</a></li>
<li><a class="reference internal" href="#installing-from-source">Installing from source</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#integration-with-geopandas-and-shapely">Integration with GeoPandas and Shapely</a></li>
<li><a class="reference internal" href="#supported-versions">Supported versions</a><ul>
<li><a class="reference internal" href="#apache-spark">Apache Spark</a></li>
<li><a class="reference internal" href="#geospark">GeoSpark</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">geo_pyspark</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>Welcome to geo_pyspark documentation!</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="welcome-to-geo-pyspark-documentation">
<h1>Welcome to geo_pyspark documentation!<a class="headerlink" href="#welcome-to-geo-pyspark-documentation" title="Permalink to this headline">¶</a></h1>
<p>Welcome to Documentation.
Contents:</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Package is a Python wrapper on scala library GeoSparkSQL. Official repository for GeoSpark can be found at <a class="reference external" href="https://github.com/DataSystemsLab/GeoSpark">https://github.com/DataSystemsLab/GeoSpark</a>.</p>
<p>Package allow to use all GeoSparkSQL functions and transform it to Python Shapely geometry objects. Also it allows to create Spark DataFrame with GeoSpark UDT from Shapely geometry objects. Spark DataFrame can be converted to GeoPandas easily, in addition all fiona drivers for shape file are available to load data from files and convert them to Spark DataFrame. Please look at examples.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>geo_pyspark depnds on Python packages and Scala libraries. To see all dependencies
please look at Dependencies section.
<a class="reference external" href="https://pypi.org/project/pyspark/">https://pypi.org/project/pyspark/</a>.</p>
<p>Package needs 3 jar files to work properly:</p>
<ul class="simple">
<li>geospark-sql_2.2-1.2.0.jar</li>
<li>geospark-1.2.0.jar</li>
<li>geo_wrapper.jar</li>
</ul>
<p>Where 2.2 is a Spark version and 1.2.0 is GeoSpark version. Jar files are placed in geo_pyspark/jars. For newest GeoSpark release jar files are places in subdirectories named as Spark version. Example, jar files for SPARK 2.4 can be found in directory geo_pyspark/jars/2_4.</p>
<p>For older version please find appropriate jar files in directory geo_pyspark/jars/previous.</p>
<p>It is possible to automatically add jar files for newest GeoSpark version. Please use code as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="kn">from</span> <span class="nn">geo_pyspark.register</span> <span class="kn">import</span> <span class="n">upload_jars</span>
<span class="kn">from</span> <span class="nn">geo_pyspark.register</span> <span class="kn">import</span> <span class="n">GeoSparkRegistrator</span>

<span class="n">upload_jars</span><span class="p">()</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span>\
      <span class="n">getOrCreate</span><span class="p">()</span>

<span class="n">GeoSparkRegistrator</span><span class="o">.</span><span class="n">registerAll</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
</pre></div>
</div>
<p>Function</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">upload_jars</span><span class="p">()</span>
</pre></div>
</div>
<p>uses findspark Python package to upload jar files to executor and nodes. To avoid copying all the time, jar files can be put in directory $SPARK_HOME/jars or any other path specified in Spark config files.</p>
<div class="section" id="installing-from-wheel-file">
<h3>Installing from wheel file<a class="headerlink" href="#installing-from-wheel-file" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pipenv run python -m pip install dist/geo_pyspark-0.2.0-py3-none-any.whl
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install dist/geo_pyspark-0.2.0-py3-none-any.whl
</pre></div>
</div>
</div>
<div class="section" id="installing-from-source">
<h3>Installing from source<a class="headerlink" href="#installing-from-source" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 setup.py install
</pre></div>
</div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="integration-with-geopandas-and-shapely">
<h2>Integration with GeoPandas and Shapely<a class="headerlink" href="#integration-with-geopandas-and-shapely" title="Permalink to this headline">¶</a></h2>
<p>geo_pyspark has implemented serializers and deserializers which allows to convert GeoSpark Geometry objects into Shapely BaseGeometry objects. Based on that it is possible to load the data with geopandas from file (look at Fiona possible drivers) and create Spark DataFrame based on GeoDataFrame object.</p>
<p>Example, loading the data from shapefile using geopandas read_file method and create Spark DataFrame based on GeoDataFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="kn">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="kn">from</span> <span class="nn">geo_pyspark.data</span> <span class="kn">import</span> <span class="n">data_path</span>
<span class="kn">from</span> <span class="nn">geo_pyspark.register</span> <span class="kn">import</span> <span class="n">GeoSparkRegistrator</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span>\
      <span class="n">getOrCreate</span><span class="p">()</span>

<span class="n">GeoSparkRegistrator</span><span class="o">.</span><span class="n">registerAll</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>

<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;gis_osm_pois_free_1.shp&quot;</span><span class="p">)</span>

<span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
  <span class="n">gdf</span>
<span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+---------+----+-----------+--------------------+--------------------+</span>
<span class="o">|</span>   <span class="n">osm_id</span><span class="o">|</span><span class="n">code</span><span class="o">|</span>     <span class="n">fclass</span><span class="o">|</span>                <span class="n">name</span><span class="o">|</span>            <span class="n">geometry</span><span class="o">|</span>
<span class="o">+---------+----+-----------+--------------------+--------------------+</span>
<span class="o">|</span> <span class="mi">26860257</span><span class="o">|</span><span class="mi">2422</span><span class="o">|</span>  <span class="n">camp_site</span><span class="o">|</span>            <span class="n">de</span> <span class="n">Kroon</span><span class="o">|</span><span class="n">POINT</span> <span class="p">(</span><span class="mf">15.3393145</span><span class="o">...|</span>
<span class="o">|</span> <span class="mi">26860294</span><span class="o">|</span><span class="mi">2406</span><span class="o">|</span>     <span class="n">chalet</span><span class="o">|</span>      <span class="n">Leśne</span> <span class="n">Ustronie</span><span class="o">|</span><span class="n">POINT</span> <span class="p">(</span><span class="mf">14.8709625</span><span class="o">...|</span>
<span class="o">|</span> <span class="mi">29947493</span><span class="o">|</span><span class="mi">2402</span><span class="o">|</span>      <span class="n">motel</span><span class="o">|</span>                <span class="n">null</span><span class="o">|</span><span class="n">POINT</span> <span class="p">(</span><span class="mf">15.0946636</span><span class="o">...|</span>
<span class="o">|</span> <span class="mi">29947498</span><span class="o">|</span><span class="mi">2602</span><span class="o">|</span>        <span class="n">atm</span><span class="o">|</span>                <span class="n">null</span><span class="o">|</span><span class="n">POINT</span> <span class="p">(</span><span class="mf">15.0732014</span><span class="o">...|</span>
<span class="o">|</span> <span class="mi">29947499</span><span class="o">|</span><span class="mi">2401</span><span class="o">|</span>      <span class="n">hotel</span><span class="o">|</span>                <span class="n">null</span><span class="o">|</span><span class="n">POINT</span> <span class="p">(</span><span class="mf">15.0696777</span><span class="o">...|</span>
<span class="o">|</span> <span class="mi">29947505</span><span class="o">|</span><span class="mi">2401</span><span class="o">|</span>      <span class="n">hotel</span><span class="o">|</span>                <span class="n">null</span><span class="o">|</span><span class="n">POINT</span> <span class="p">(</span><span class="mf">15.0155749</span><span class="o">...|</span>
<span class="o">+---------+----+-----------+--------------------+--------------------+</span>
</pre></div>
</div>
<p>Reading data with Spark and converting to GeoPandas</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="kn">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="kn">from</span> <span class="nn">geo_pyspark.data</span> <span class="kn">import</span> <span class="n">data_path</span>
<span class="kn">from</span> <span class="nn">geo_pyspark.register</span> <span class="kn">import</span> <span class="n">GeoSparkRegistrator</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span>\
      <span class="n">getOrCreate</span><span class="p">()</span>

<span class="n">GeoSparkRegistrator</span><span class="o">.</span><span class="n">registerAll</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>

<span class="n">counties</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span>\
  <span class="n">read</span><span class="o">.</span>\
  <span class="n">option</span><span class="p">(</span><span class="s2">&quot;delimiter&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span><span class="o">.</span>\
  <span class="n">option</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span><span class="o">.</span>\
  <span class="n">csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s2">&quot;counties.csv&quot;</span><span class="p">))</span>

<span class="n">counties</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;county&quot;</span><span class="p">)</span>

<span class="n">counties_geom</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span>
        <span class="s2">&quot;SELECT *, st_geomFromWKT(geom) as geometry from county&quot;</span>
<span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">counties_geom</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="supported-versions">
<h2>Supported versions<a class="headerlink" href="#supported-versions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="apache-spark">
<h3>Apache Spark<a class="headerlink" href="#apache-spark" title="Permalink to this headline">¶</a></h3>
<p>Currently package supports spark versions</p>
<ul class="simple">
<li>2.2</li>
<li>2.3</li>
<li>2.4</li>
</ul>
</div>
<div class="section" id="geospark">
<h3>GeoSpark<a class="headerlink" href="#geospark" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>1.2.0</li>
<li>1.1.3</li>
</ul>
<div class="toctree-wrapper compound">
</div>
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Pawel Kocinski

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>